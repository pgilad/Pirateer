var app=angular.module("app",[]),_gaq=_gaq||[];!function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b),_gaq.push(["_setAccount","UA-43678943-3"])}(),app.run(["searchService","$rootScope",function(a,b){function c(b,e){var f;b.length&&d&&(f=b.shift(),a.searchIMDB(f).then(function(a){if(d){for(var f=0;f<a.indexArr.length;++f)try{e.postMessage({type:"ratingResponse",title:a.title,index:a.indexArr[f],rating:a.rating,id:a.id})}catch(g){}c(b,e)}},function(){c(b,e)}))}var d=!1,e=[],f=function(a){for(var b,c,d=0;d<a.length;++d){var f=a[d].name;f=f.replace(/\./g," ").replace(/\-/g," ").replace(/_/g," ").replace(/\(/g," ").replace(/\)/g," ").replace(/\[/g," ").replace(/\]/g," ").replace(/\s\s+/g," ").replace(/\s$/,"");var g=/\d{4}/g.exec(f);g?(b=f.substring(0,g.index-1),c=parseInt(g[0])):(b=f,c=null);var h=_.find(e,{title:b,year:c});h?h.indexArr.push(a[d].index):e.push({title:b,year:c,indexArr:[a[d].index]})}};chrome.runtime.onConnect.addListener(function(a){a.onDisconnect.addListener(function(){d=!1,a.onMessage.removeListener()}),"getRating"===a.name&&a.onMessage.addListener(function(g){"list"===g.type&&(_gaq.push(["_trackPageview"]),_gaq.push(["_trackEvent","Search","fromIMDB",decodeURI(a.sender.url)]),d=!0,e=[],f(g.list),b.$apply(function(){c(angular.copy(e,[]),a)}))})}),chrome.runtime.onInstalled.addListener(function(a){var b=chrome.runtime.getManifest().version||"Unknown";_gaq.push(["_trackEvent","App_Load",a.reason,b])})}]);